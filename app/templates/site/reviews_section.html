<div class="reviews-section">
    <h3>Đánh giá sản phẩm</h3>
    
    <!-- Reviews Summary -->
    {% if product.rating %}
    <div class="reviews-summary p-3 bg-light rounded mb-4">
        <div class="row">
            <div class="col-md-6">
                <div class="text-center">
                    <div class="h2 text-primary mb-1">{{ "%.1f" | format(product.rating.avg) }}</div>
                    {% include '_partials/rating_stars.html' %}
                    <div class="text-muted mt-1">{{ product.rating.count }} đánh giá</div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Review Form -->
    <div class="review-form mb-4">
        <h5>Viết đánh giá</h5>
        <form method="POST" action="{{ url_for('site.submit_review', slug=product.slug) }}">
            {{ review_form.hidden_tag() }}
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    {{ review_form.user_name.label(class="form-label") }}
                    {{ review_form.user_name(class="form-control") }}
                </div>
                
                <div class="col-md-6 mb-3">
                    {{ review_form.rating.label(class="form-label") }}
                    <div class="rating-input">
                        {% for i in range(1, 6) %}
                        <input type="radio" name="rating" value="{{ i }}" id="star{{ i }}" required>
                        <label for="star{{ i }}" class="star-label">
                            <i class="bi bi-star"></i>
                        </label>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                {{ review_form.content.label(class="form-label") }}
                {{ review_form.content(class="form-control") }}
            </div>
            
            <button type="submit" class="btn btn-primary">Gửi đánh giá</button>
        </form>
    </div>

    <!-- Reviews List -->
    <div class="reviews-list">
        <h5>Các đánh giá khác ({{ reviews.total }} đánh giá)</h5>
        
        {% if reviews.items %}
            {% for review in reviews.items %}
            <div class="review-item border-bottom py-3">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <div>
                        <strong>{{ review.user_name or 'Khách hàng' }}</strong>
                        <div class="rating-display">
                            {% for i in range(1, 6) %}
                                {% if i <= review.rating %}
                                    <i class="bi bi-star-fill text-warning"></i>
                                {% else %}
                                    <i class="bi bi-star text-muted"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <small class="text-muted">{{ review.created_at.strftime('%d/%m/%Y %H:%M') }}</small>
                </div>
                <p class="mb-0">{{ review.content }}</p>
            </div>
            {% endfor %}
            
            <!-- Reviews Pagination -->
            {% if reviews.total > 10 %}
            <div class="mt-4">
                {% set page = request.args.get('page', 1, type=int) %}
                {% set page_size = 10 %}
                {% set total = reviews.total %}
                {% include '_partials/pagination.html' %}
            </div>
            {% endif %}
        {% else %}
            <div class="text-center text-muted py-4">
                <p>Chưa có đánh giá nào. Hãy là người đầu tiên đánh giá sản phẩm này!</p>
            </div>
        {% endif %}
    </div>
</div>

<style>
.rating-input {
    display: flex;
    flex-direction: row-reverse;
    justify-content: flex-end;
}

.rating-input input[type="radio"] {
    display: none;
}

.rating-input .star-label {
    color: #ddd;
    font-size: 1.2em;
    cursor: pointer;
    transition: color 0.2s;
}

.rating-input .star-label:hover,
.rating-input .star-label:hover ~ .star-label,
.rating-input input[type="radio"]:checked ~ .star-label {
    color: #ffc107;
}
</style>